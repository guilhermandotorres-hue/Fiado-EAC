<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Caderneta de Fiado</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
    }
    .logo {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 180px; /* aumentei o tamanho da logo */
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: rgb(255, 255, 255);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      margin-top: 100px; /* espaço para não cobrir a logo */
    }
    input, button {
      padding: 8px;
      margin: 5px 0;
    }
    .cliente {
      margin: 15px 0;
      padding: 10px;
      border: 1px solid #bbbbbb;
      border-radius: 8px;
    }
    .compras {
      margin-top: 10px;
    }
    .item {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
      background: #eee;
      padding: 5px 10px;
      border-radius: 6px;
    }
    .total {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- Logo -->
  <img src="Made with insMind-Logo-do-EAC.png" class="logo" alt="Logo EAC">

  <div class="container">
    <h1>Caderneta de Fiado</h1>
    <input type="text" id="nomeCliente" placeholder="Nome do cliente">
    <button onclick="adicionarCliente()">Adicionar Cliente</button>
    
    <div id="listaClientes"></div>
  </div>

  <script>
    let clientes = [];

    // ---- Funções para LocalStorage ----
    function salvarDados() {
      localStorage.setItem("cadernetaFiado", JSON.stringify(clientes));
    }

    function carregarDados() {
      const dados = localStorage.getItem("cadernetaFiado");
      if (dados) {
        clientes = JSON.parse(dados);
        renderClientes();
      }
    }

    // ---- Funções principais ----
    function adicionarCliente() {
      const nome = document.getElementById("nomeCliente").value;
      if (nome.trim() === "") return alert("Digite o nome do cliente!");

      clientes.push({ nome, compras: [] });
      document.getElementById("nomeCliente").value = "";
      salvarDados();
      renderClientes();
    }

    function adicionarCompra(index) {
      const produto = prompt("Produto:");
      const valor = parseFloat(prompt("Valor:"));
      if (!produto || isNaN(valor)) return alert("Dados inválidos!");
      
      clientes[index].compras.push({ produto, valor });
      salvarDados();
      renderClientes();
    }

    function editarCompra(cIndex, iIndex) {
      const novaDesc = prompt("Novo produto:", clientes[cIndex].compras[iIndex].produto);
      const novoValor = parseFloat(prompt("Novo valor:", clientes[cIndex].compras[iIndex].valor));
      if (!novaDesc || isNaN(novoValor)) return;

      clientes[cIndex].compras[iIndex] = { produto: novaDesc, valor: novoValor };
      salvarDados();
      renderClientes();
    }

    function removerCompra(cIndex, iIndex) {
      clientes[cIndex].compras.splice(iIndex, 1);
      salvarDados();
      renderClientes();
    }

    function editarCliente(cIndex) {
      const novoNome = prompt("Novo nome do cliente:", clientes[cIndex].nome);
      if (!novoNome) return;
      clientes[cIndex].nome = novoNome;
      salvarDados();
      renderClientes();
    }

    function apagarCliente(cIndex) {
      if (confirm("Tem certeza que deseja apagar toda a lista deste cliente?")) {
        clientes.splice(cIndex, 1);
        salvarDados();
        renderClientes();
      }
    }

    function calcularTotal(compras) {
      return compras.reduce((sum, item) => sum + item.valor, 0);
    }

    function renderClientes() {
      const lista = document.getElementById("listaClientes");
      lista.innerHTML = "";
      clientes.forEach((cliente, cIndex) => {
        const div = document.createElement("div");
        div.className = "cliente";

        let html = `<h3>${cliente.nome}</h3>
                    <button onclick="adicionarCompra(${cIndex})">Adicionar Compra</button>
                    <button onclick="editarCliente(${cIndex})">Editar Cliente</button>
                    <button onclick="apagarCliente(${cIndex})">Apagar Cliente</button>
                    <div class="compras">`;

        cliente.compras.forEach((item, iIndex) => {
          html += `<div class="item">
                     ${item.produto} - R$ ${item.valor.toFixed(2)}
                     <span>
                       <button onclick="editarCompra(${cIndex}, ${iIndex})">✏️</button>
                       <button onclick="removerCompra(${cIndex}, ${iIndex})">❌</button>
                     </span>
                   </div>`;
        });

        html += `</div>
                 <div class="total">Total: R$ ${calcularTotal(cliente.compras).toFixed(2)}</div>`;

        div.innerHTML = html;
        lista.appendChild(div);
      });
    }

    // ---- Carregar dados ao abrir a página ----
    window.onload = carregarDados;
  </script>
</body>
</html>
